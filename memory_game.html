<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>記憶力ゲーム</title>
    <link rel="stylesheet" href="win95_theme.css">
    <style>
        /* Specific styles for memory_game.html to override/complement win95_theme.css */
        .window-frame {
            max-width: 500px; /* Adjusted for game board */
        }
        #game-board {
            display: grid;
            grid-template-columns: repeat(4, 100px);
            grid-template-rows: repeat(4, 100px);
            gap: 10px;
            margin: 20px auto;
            border: 2px inset #808080;
            background-color: #C0C0C0;
            padding: 5px;
        }
        .card {
            width: 100px;
            height: 100px;
            background-color: #C0C0C0;
            border-top: 2px solid #FFFFFF;
            border-left: 2px solid #FFFFFF;
            border-right: 2px solid #808080;
            border-bottom: 2px solid #808080;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5em;
            color: #000000;
            cursor: pointer;
            transition: none;
            transform-style: preserve-3d;
            position: relative;
        }
        .card.flipped {
            background-color: #D0D0D0;
            border: 1px solid #808080;
            cursor: default;
        }
        .card.matched {
            background-color: #D0D0D0;
            border: 1px solid #808080;
            cursor: default;
            opacity: 0.6;
        }
        .card-inner {
            position: absolute;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 0;
        }
        .card-front {
            background-color: #C0C0C0;
            color: #000000;
            font-size: 2.5em;
            border-top: 2px solid #FFFFFF;
            border-left: 2px solid #FFFFFF;
            border-right: 2px solid #808080;
            border-bottom: 2px solid #808080;
        }
        .card-back {
            background-color: #007bff;
            color: white;
            transform: rotateY(180deg);
            font-size: 2.5em;
            border-top: 2px solid #FFFFFF;
            border-left: 2px solid #FFFFFF;
            border-right: 2px solid #808080;
            border-bottom: 2px solid #808080;
        }
        #status {
            margin-top: 10px;
            font-size: 1em;
            color: #000000;
        }
        #score {
            font-size: 1em;
            color: #000000;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="window-frame">
        <div class="window-title-bar">
            <span>記憶力ゲーム</span>
            <button>_</button>
            <button>X</button>
        </div>
        <div class="window-content">
            <h1>記憶力ゲーム</h1>
            <div id="game-board"></div>
            <div id="status"></div>
            <div id="score">めくった回数: 0</div>
            <div class="controls">
                <button class="reset-button" id="resetButton">新しいゲーム</button>
                <button class="back-button" onclick="location.href='index.html'">メニューに戻る</button>
            </div>
        </div>
    </div>

    <!-- Modal Dialog HTML -->
    <div id="gameModal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title-bar">
                <span>メッセージ</span>
            </div>
            <div class="modal-content">
                <p id="modalMessage"></p>
                <button id="modalButton">OK</button>
            </div>
        </div>
    </div>

    <script>
        const gameBoard = document.getElementById('game-board');
        const statusDisplay = document.getElementById('status');
        const scoreDisplay = document.getElementById('score');
        const resetButton = document.getElementById('resetButton');

        // Modal elements
        const gameModal = document.getElementById("gameModal");
        const modalMessage = document.getElementById("modalMessage");
        const modalButton = document.getElementById("modalButton");

        const cardValues = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let canFlip = true;
        let flipCount = 0;

        // Modal functions
        function showModal(message, buttonText, callback) {
            modalMessage.textContent = message;
            modalButton.textContent = buttonText;
            modalButton.onclick = () => {
                gameModal.classList.remove("visible");
                if (callback) callback();
            };
            gameModal.classList.add("visible");
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createBoard() {
            gameBoard.innerHTML = '';
            cards = [];
            flippedCards = [];
            matchedPairs = 0;
            canFlip = true;
            flipCount = 0;
            statusDisplay.textContent = 'カードをめくってください';
            scoreDisplay.textContent = `めくった回数: ${flipCount}`;

            const gameCards = shuffle([...cardValues, ...cardValues]);

            gameCards.forEach((value, index) => {
                const cardElement = document.createElement('div');
                cardElement.classList.add('card');
                cardElement.dataset.value = value;
                cardElement.dataset.index = index;

                const cardInner = document.createElement('div');
                cardInner.classList.add('card-inner');

                const cardFront = document.createElement('div');
                cardFront.classList.add('card-front');
                cardFront.textContent = '?'; // Or an icon

                const cardBack = document.createElement('div');
                cardBack.classList.add('card-back');
                cardBack.textContent = value;

                cardInner.appendChild(cardFront);
                cardInner.appendChild(cardBack);
                cardElement.appendChild(cardInner);

                cardElement.addEventListener('click', () => flipCard(cardElement));
                gameBoard.appendChild(cardElement);
                cards.push(cardElement);
            });

            // Briefly show all cards at the start
            cards.forEach(card => card.classList.add('flipped'));
            setTimeout(() => {
                cards.forEach(card => card.classList.remove('flipped'));
            }, 2000); // Show for 2 seconds
        }

        function flipCard(card) {
            if (!canFlip || card.classList.contains('flipped') || card.classList.contains('matched')) {
                return;
            }

            card.classList.add('flipped');
            flippedCards.push(card);
            flipCount++;
            scoreDisplay.textContent = `めくった回数: ${flipCount}`;

            if (flippedCards.length === 2) {
                canFlip = false;
                setTimeout(checkForMatch, 1000);
            }
        }

        function checkForMatch() {
            const [card1, card2] = flippedCards;

            if (card1.dataset.value === card2.dataset.value) {
                card1.classList.add('matched');
                card2.classList.add('matched');
                matchedPairs++;
                if (matchedPairs === cardValues.length) {
                    showModal('ゲームクリア！おめでとうございます！', "OK", createBoard);
                } else {
                    statusDisplay.textContent = 'マッチしました！';
                }
            } else {
                card1.classList.remove('flipped');
                card2.classList.remove('flipped');
                statusDisplay.textContent = '残念、違いました。';
            }
            flippedCards = [];
            canFlip = true;
        }

        resetButton.addEventListener('click', createBoard);

        createBoard();
    </script>
</body>
</html>